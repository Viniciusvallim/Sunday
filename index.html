<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Projetos da Equipe | Tecparts do Brasil</title>
  <link rel="icon" href="https://tecparts.com.br/wp-content/uploads/2022/01/cropped-favicon-32x32.png" sizes="32x32" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --verde-escuro: #2f4f24;
      --verde-medio: #3e6d38;
      --verde-leve: #dbe8d5;
      --verde-hover: #4d733a;
      --verde-header: #e1e9d6;
      --sombra: 0 2px 8px rgba(40,50,60,0.07);
      --borda-sidebar: #b7c7a7;
    }
    body { margin: 0; background: #f7f8fa; font-family: 'Inter', Arial, sans-serif; color: #222; display: flex; min-height: 100vh; }
    .sidebar { position: fixed; top: 0; left: 0; bottom: 0; width: 260px; background: var(--verde-leve); border-right: 1px solid var(--borda-sidebar); display: flex; flex-direction: column; min-height: 100vh;}
    .logo-container { display: flex; flex-direction: column; align-items: center; padding: 28px 12px 16px 12px; border-bottom: 1px solid var(--borda-sidebar); min-height: 87px; justify-content: center; position:relative;}
    .logo-img { width: 160px; height: auto; object-fit: contain; margin-bottom: 0; margin-top: 4px; display: block; border-radius: 6px; box-shadow: none; background: none; }
    .company-title { color: var(--verde-escuro); font-weight: 700; font-size: 1.13rem; letter-spacing: 0.7px; margin-top: 10px; margin-bottom: 0; text-align: center; opacity: 0.92; user-select: none; display: none;}
    nav { display: flex; flex-direction: column; gap: 8px; margin-top: 28px; padding-left: 26px;}
    nav a { font-weight:700; font-size: 1.11rem; color: var(--verde-escuro); text-decoration: none; padding: 10px 16px; border-radius: 8px; transition: background 0.18s; margin-right: 10px; margin-bottom: 2px; display: flex; align-items: center;}
    nav a.active, nav a:hover { background: var(--verde-escuro); color: #fff;}
    main { margin-left: 260px; padding: 42px 5vw 34px 5vw; box-sizing: border-box; flex-grow: 1; min-height: 100vh; background: linear-gradient(rgba(255,255,255,0.6), rgba(255,255,255,0.6)), url('tecparts.png') center center / cover no-repeat; display: flex; flex-direction: column;}
    h1.main-header { color: var(--verde-escuro); font-weight: 800; margin-bottom: 20px; font-size: 2.15rem; letter-spacing: 1px; line-height: 1.1; display: flex; align-items: center; gap: 12px;}
    .header-actions { margin-bottom: 28px; display: flex; gap: 15px; flex-wrap: wrap;}
    .btn { background: var(--verde-escuro); color: #fff; border-radius: 24px; padding: 10px 32px; font-weight: 600; font-size: 1.04rem; border: none; cursor: pointer; transition: background-color 0.17s; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; box-shadow: 0 2px 12px 0 rgba(50,90,46,0.04); outline: none;}
    .btn:hover { background: var(--verde-hover);}
    table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 680px; background: #f9faf9; border-radius: 15px; overflow: hidden; box-shadow: var(--sombra);}
    thead tr { background: var(--verde-header);}
    th, td { padding: 16px 20px; text-align: left; border-bottom: 1px solid var(--verde-header); color: var(--verde-escuro); font-size: 1rem;}
    th { font-weight: 700; background: var(--verde-header); letter-spacing: 0.2px;}
    tbody tr:hover { background: #f1f7e7;}
    .btn-delete { background: #dc3545; color: #fff; border-radius: 18px; padding: 6px 18px; font-weight: 600; cursor: pointer; border: none; transition: background-color 0.18s; font-size: 0.98rem;}
    .btn-delete:hover { background: #a72631;}
    @media(max-width: 920px) { table { min-width: 500px;} main { padding: 24px 3vw 20px 3vw;} }
    @media(max-width: 720px) {
      .sidebar { width: 60px; padding-top: 10px;}
      .logo-container { padding: 6px 3px 0 3px; min-height: 56px;}
      .logo-img { max-width: 32px !important; height: 32px; margin-top: 4px;}
      nav a { font-size: 0; padding: 10px 3px; width: 36px; justify-content: center;}
      main { margin-left: 60px; padding: 13px 1vw 14px 1vw;}
      table {min-width: 100%;}
    }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="logo-container">
      <img class="logo-img" src="logo tec.png" alt="Tecparts do Brasil" />
      <div class="company-title">Tecparts do Brasil</div>
    </div>
    <nav>
      <a href="index.html" class="active">Projetos</a>
      <a href="VisaoGeral.html">Visão Geral Projetos</a>
      <a href="Dashboard.html">Dashboard</a>
      <a href="contatos.html">Colaboradores</a>
      <a href="Config.html">Configurações</a>
    </nav>
  </aside>
  <main>
    <h1 class="main-header">Projetos da Equipe</h1>
    <div class="header-actions">
      <button onclick="window.location.href='NovoProjeto.html'" class="btn">Novo Projeto</button>
      <button onclick="window.location.href='NovaTarefa.html'" class="btn">Nova Tarefa</button>
    </div>
    <table>
      <thead>
        <tr>
          <th>Projeto</th>
          <th>Líder</th>
          <th>Início</th>
          <th>Previsão Término</th>
          <th>Comentários</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="projects-table-body"></tbody>
    </table>
  </main>
  <!-- Firebase App (base) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <!-- Firebase Database -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <script>
    // FIREBASE CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyAkbUo-zQiwTPxVspA2nM35nEXmS4rN5C4",
      authDomain: "sunday-a6b04.firebaseapp.com",
      projectId: "sunday-a6b04",
      storageBucket: "sunday-a6b04.appspot.com",
      messagingSenderId: "907213226288",
      appId: "1:907213226288:web:2c9c9fa12a7d76c3b588f5",
      databaseURL: "https://sunday-a6b04-default-rtdb.firebaseio.com"
    };
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const database = firebase.database();

    function formatarDataAjustada(d) {
      if (!d) return '';
      try {
        const dataObj = new Date(d);
        if (isNaN(dataObj)) return d;
        dataObj.setDate(dataObj.getDate() + 1);
        return dataObj.toLocaleDateString('pt-BR');
      } catch { return d; }
    }
    function formatarData(d) {
      if (!d) return '';
      try {
        const dataObj = new Date(d);
        if (isNaN(dataObj)) return d;
        return dataObj.toLocaleDateString('pt-BR');
      } catch { return d; }
    }

    const tbody = document.getElementById('projects-table-body');

    // Renderização da tabela
    function renderTable(snapshot) {
      tbody.innerHTML = '';
      let idx = 0;
      const projetos = [];
      snapshot.forEach(child => {
        let p = child.val();
        p._firebaseKey = child.key;
        p._idx = idx++;
        projetos.push(p);
      });
      projetos.forEach((p, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>
            <a href="pagina_projeto.html?idx=${i}&firebaseKey=${p._firebaseKey}" 
            style="color:#2f4f24; font-weight: 700; text-decoration:none;" title="Ver detalhes do projeto ${p.nome}">
              ${p.nome}
            </a>
          </td>
          <td>${p.lider}</td>
          <td>${formatarDataAjustada(p.inicio)}</td>
          <td>${formatarData(p.entrega)}</td>
          <td>${p.coment || ''}</td>
          <td>
            <button class="btn-delete" data-key="${p._firebaseKey}" title="Excluir este projeto">Excluir</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.onclick = function() {
          const key = btn.dataset.key;
          if(confirm('Deseja realmente excluir este projeto? Essa ação não pode ser desfeita.')) {
            database.ref('projetos/'+key).remove();
            // Não chama renderTable de novo, pois o listener já cobre!
          }
        };
      });
    }

    // Carrega/atualiza os projetos em tempo real:
    database.ref('projetos').on('value', renderTable);
  </script>
</body>
</html>
